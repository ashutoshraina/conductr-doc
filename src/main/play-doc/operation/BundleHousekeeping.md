# Bundle Housekeeping

Both ConductR core and agent performs their own housekeeping to clean up of the files generated by the bundles.

# ConductR core housekeeping

ConductR core also performs the functionality of a file server to serve bundle files which has been loaded into ConductR.

As such, the bundle `.zip` files are stored in the bundle storage directory as long as the bundle stays within ConductR. The bundle storage directory is located at `${java.io.tmpdir}/conductr/${conductr.ip}/bundles` by default .

Whether a bundle `.zip` file will be present in this storage directory is decided by the configured number of replicas required per bundle. By default there will be `3` replicas of the `.zip` file per bundle. This is means for a cluster of `5` nodes, there will be `3` nodes hosting the `.zip` file for any given bundle.

The bundle `.zip` file will only be deleted when the bundle is unloaded from ConductR.


# ConductR agent

ConductR agent manages the execution of the bundles in ConductR.

As such, before starting a bundle, ConductR agent will request the `.zip` file from ConductR core. The `.zip` file will then be downloaded into the bundle working directory.

The bundle working directory by default is located at `${java.io.tmpdir}/conductr-agent/${conductr.agent.ip}/bundles` by default.

ConductR agent runs a background housekeeping task which will delete expired files and directories within the bundle working directory.

Whenever a bundle process is started, the corresponding bundle `.zip` file will expanded so the start script can be executed to start the bundle process. When this bundle process terminates (either normally or abnormally), the bundle expanded directory will be left behind. The next attempt to start the same bundle will cause the bundle `.zip` file to be expanded to a new directory.

In other words, each attempt to start a bundle will create a new expanded bundle directory.

ConductR agent housekeeping task will attempt to preserve the latest `2` of these expanded directories given any bundle. This will also mean a bundle which keeps on restarting itself won't be able to fill the disk with its expanded bundle directories.

By default, the housekeeping task will try to keep the bundle storage directory under `4GB`, and will remove all files and directories contained within bundle storage directory older than `30 days`.


Please refer to [Configuration Reference](ConfigurationRef) for further details on the housekeeping configuration.
